import{j as o,r as kn,t as he}from"./index.DGnL12i5.js";import{r as d}from"./index.C-6U_n5O.js";import{b as Ee,c as tt,d as nt,e as Nn,f as ne,P as ee,g as jn,h as St,o as Re,i as ze,j as En,T as Rn,G as Pn,k as Te,l as Mn,R as In,m as Dn,n as _n,F as zn,D as Tn,p as An,q as Fe,C as On,a as Bn,r as Ln}from"./useMobile.BG_X1q4Z.js";import{u as oe,c as ce,b as $n,d as W,B as X,C as me,e as ge,f as xe,a as ye,g as Fn}from"./createLucideIcon.LhHHhSz9.js";import{D as We,S as Hn}from"./share-2.Be65sOeX.js";import{L as Yn,S as He}from"./ShareService.PWNGVxnr.js";const De={UNDO:{key:"z",ctrlKey:!0,description:"Undo last action",action:"undo"},REDO:{key:"z",ctrlKey:!0,shiftKey:!0,description:"Redo last undone action",action:"redo"},CLEAR_CANVAS:{key:"Delete",description:"Clear entire canvas",action:"clearCanvas"},CLEAR_CANVAS_ALT:{key:"Backspace",ctrlKey:!0,description:"Clear entire canvas (alternative)",action:"clearCanvas"},PEN_TOOL:{key:"1",description:"Select pen tool",action:"selectPen"},ERASER_TOOL:{key:"2",description:"Select eraser tool",action:"selectEraser"},SPRAY_TOOL:{key:"3",description:"Select spray tool",action:"selectSpray"},TEXTURE_TOOL:{key:"4",description:"Select texture tool",action:"selectTexture"},PAN_MODE:{key:" ",description:"Hold to pan canvas",action:"panMode"},ZOOM_IN:{key:"=",ctrlKey:!0,description:"Zoom in",action:"zoomIn"},ZOOM_IN_PLUS:{key:"+",ctrlKey:!0,description:"Zoom in",action:"zoomIn"},ZOOM_OUT:{key:"-",ctrlKey:!0,description:"Zoom out",action:"zoomOut"},ZOOM_RESET:{key:"0",ctrlKey:!0,description:"Reset zoom to 100%",action:"zoomReset"},FIT_TO_SCREEN:{key:"f",ctrlKey:!0,description:"Fit canvas to screen",action:"fitToScreen"},SAVE:{key:"s",ctrlKey:!0,description:"Save drawing to vault",action:"save"},EXPORT:{key:"e",ctrlKey:!0,description:"Export drawing",action:"export"},NEW_DRAWING:{key:"n",ctrlKey:!0,description:"New drawing",action:"newDrawing"},TOGGLE_SIDEBAR:{key:"t",ctrlKey:!0,description:"Toggle sidebar",action:"toggleSidebar"},TOGGLE_VAULT:{key:"v",ctrlKey:!0,description:"Toggle vault view",action:"toggleVault"},BLACK_COLOR:{key:"b",description:"Select black color",action:"selectBlack"},WHITE_COLOR:{key:"w",description:"Select white color",action:"selectWhite"},RED_COLOR:{key:"r",description:"Select red color",action:"selectRed"},INCREASE_SIZE:{key:"]",description:"Increase brush size",action:"increaseBrushSize"},DECREASE_SIZE:{key:"[",description:"Decrease brush size",action:"decreaseBrushSize"}};class K{static handlers=new Map;static registerHandler(e,s){this.handlers.set(e,s)}static unregisterHandler(e){this.handlers.delete(e)}static handleKeyEvent(e){const s=this.findMatchingBinding(e);if(s){const a=this.handlers.get(s.action);if(a)return e.preventDefault(),a(),!0}return!1}static findMatchingBinding(e){for(const s of Object.values(De))if(this.matchesBinding(e,s))return s;return null}static matchesBinding(e,s){return e.key.toLowerCase()===s.key.toLowerCase()&&!!e.ctrlKey==!!s.ctrlKey&&!!e.shiftKey==!!s.shiftKey&&!!e.altKey==!!s.altKey&&!!e.metaKey==!!s.metaKey}static getBindingDescription(e){const s=Object.values(De).find(r=>r.action===e);if(!s)return"";const a=[];s.ctrlKey&&a.push("Ctrl"),s.shiftKey&&a.push("Shift"),s.altKey&&a.push("Alt"),s.metaKey&&a.push("Cmd");const n=s.key===" "?"Space":s.key;return a.length>0?`${a.join("+")}+${n}`:n}static getAllBindings(){return Object.values(De)}}const Un=(t,e,s,a)=>{const n=Ee();d.useEffect(()=>{K.registerHandler("undo",()=>n.undo()),K.registerHandler("redo",()=>n.redo()),K.registerHandler("clearCanvas",()=>{confirm("Are you sure you want to clear the canvas? This action cannot be undone.")&&n.clear()}),K.registerHandler("selectPen",()=>n.setBrushStyle("ink")),K.registerHandler("selectEraser",()=>n.setBrushStyle("eraser")),K.registerHandler("selectSpray",()=>n.setBrushStyle("spray")),K.registerHandler("selectTexture",()=>n.setBrushStyle("texture")),K.registerHandler("zoomIn",()=>{n.setZoom(Math.min(5,n.zoom*1.2))}),K.registerHandler("zoomOut",()=>{n.setZoom(Math.max(.1,n.zoom/1.2))}),K.registerHandler("zoomReset",()=>{n.setZoom(1),n.setPan(0,0)}),K.registerHandler("fitToScreen",()=>{n.setZoom(1),n.setPan(0,0)}),K.registerHandler("save",()=>t?.()),K.registerHandler("export",()=>e?.()),K.registerHandler("newDrawing",()=>{confirm("Start a new drawing? Unsaved changes will be lost.")&&n.clear()}),K.registerHandler("toggleSidebar",()=>s?.()),K.registerHandler("toggleVault",()=>a?.()),K.registerHandler("selectBlack",()=>n.setColor("#000000")),K.registerHandler("selectWhite",()=>n.setColor("#ffffff")),K.registerHandler("selectRed",()=>n.setColor("#ef4444")),K.registerHandler("increaseBrushSize",()=>{n.setPenSize(Math.min(50,n.currentSize+2))}),K.registerHandler("decreaseBrushSize",()=>{n.setPenSize(Math.max(1,n.currentSize-2))});const r=i=>{i.target instanceof HTMLInputElement||i.target instanceof HTMLTextAreaElement||K.handleKeyEvent(i)};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r),Object.values(De).forEach(i=>{K.unregisterHandler(i.action)})}},[n,t,e,s,a])};function wt(t,[e,s]){return Math.min(s,Math.max(e,t))}function Ct(t){const e=d.useRef({value:t,previous:t});return d.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var kt=["PageUp","PageDown"],Nt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],jt={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},we="Slider",[Ze,Kn,Vn]=Nn(we),[Et,Vr]=nt(we,[Vn]),[Gn,Ae]=Et(we),Rt=d.forwardRef((t,e)=>{const{name:s,min:a=0,max:n=100,step:r=1,orientation:i="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:g=[a],value:v,onValueChange:u=()=>{},onValueCommit:x=()=>{},inverted:y=!1,form:C,...k}=t,j=d.useRef(new Set),f=d.useRef(0),p=i==="horizontal"?Xn:Wn,[R=[],E]=tt({prop:v,defaultProp:g,onChange:O=>{[...j.current][f.current]?.focus(),u(O)}}),A=d.useRef(R);function P(O){const G=es(R,O);L(O,G)}function B(O){L(O,f.current)}function te(){const O=A.current[f.current];R[f.current]!==O&&x(R)}function L(O,G,{commit:V}={commit:!1}){const Z=rs(r),q=as(Math.round((O-a)/r)*r+a,Z),N=wt(q,[a,n]);E((S=[])=>{const M=Qn(S,N,G);if(ss(M,c*r)){f.current=M.indexOf(N);const I=String(M)!==String(S);return I&&V&&x(M),I?M:S}else return S})}return o.jsx(Gn,{scope:t.__scopeSlider,name:s,disabled:l,min:a,max:n,valueIndexToChangeRef:f,thumbs:j.current,values:R,orientation:i,form:C,children:o.jsx(Ze.Provider,{scope:t.__scopeSlider,children:o.jsx(Ze.Slot,{scope:t.__scopeSlider,children:o.jsx(p,{"aria-disabled":l,"data-disabled":l?"":void 0,...k,ref:e,onPointerDown:ne(k.onPointerDown,()=>{l||(A.current=R)}),min:a,max:n,inverted:y,onSlideStart:l?void 0:P,onSlideMove:l?void 0:B,onSlideEnd:l?void 0:te,onHomeKeyDown:()=>!l&&L(a,0,{commit:!0}),onEndKeyDown:()=>!l&&L(n,R.length-1,{commit:!0}),onStepKeyDown:({event:O,direction:G})=>{if(!l){const q=kt.includes(O.key)||O.shiftKey&&Nt.includes(O.key)?10:1,N=f.current,S=R[N],M=r*q*G;L(S+M,N,{commit:!0})}}})})})})});Rt.displayName=we;var[Pt,Mt]=Et(we,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Xn=d.forwardRef((t,e)=>{const{min:s,max:a,dir:n,inverted:r,onSlideStart:i,onSlideMove:l,onSlideEnd:c,onStepKeyDown:g,...v}=t,[u,x]=d.useState(null),y=oe(e,p=>x(p)),C=d.useRef(void 0),k=jn(n),j=k==="ltr",f=j&&!r||!j&&r;function w(p){const R=C.current||u.getBoundingClientRect(),E=[0,R.width],P=st(E,f?[s,a]:[a,s]);return C.current=R,P(p-R.left)}return o.jsx(Pt,{scope:t.__scopeSlider,startEdge:f?"left":"right",endEdge:f?"right":"left",direction:f?1:-1,size:"width",children:o.jsx(It,{dir:k,"data-orientation":"horizontal",...v,ref:y,style:{...v.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:p=>{const R=w(p.clientX);i?.(R)},onSlideMove:p=>{const R=w(p.clientX);l?.(R)},onSlideEnd:()=>{C.current=void 0,c?.()},onStepKeyDown:p=>{const E=jt[f?"from-left":"from-right"].includes(p.key);g?.({event:p,direction:E?-1:1})}})})}),Wn=d.forwardRef((t,e)=>{const{min:s,max:a,inverted:n,onSlideStart:r,onSlideMove:i,onSlideEnd:l,onStepKeyDown:c,...g}=t,v=d.useRef(null),u=oe(e,v),x=d.useRef(void 0),y=!n;function C(k){const j=x.current||v.current.getBoundingClientRect(),f=[0,j.height],p=st(f,y?[a,s]:[s,a]);return x.current=j,p(k-j.top)}return o.jsx(Pt,{scope:t.__scopeSlider,startEdge:y?"bottom":"top",endEdge:y?"top":"bottom",size:"height",direction:y?1:-1,children:o.jsx(It,{"data-orientation":"vertical",...g,ref:u,style:{...g.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:k=>{const j=C(k.clientY);r?.(j)},onSlideMove:k=>{const j=C(k.clientY);i?.(j)},onSlideEnd:()=>{x.current=void 0,l?.()},onStepKeyDown:k=>{const f=jt[y?"from-bottom":"from-top"].includes(k.key);c?.({event:k,direction:f?-1:1})}})})}),It=d.forwardRef((t,e)=>{const{__scopeSlider:s,onSlideStart:a,onSlideMove:n,onSlideEnd:r,onHomeKeyDown:i,onEndKeyDown:l,onStepKeyDown:c,...g}=t,v=Ae(we,s);return o.jsx(ee.span,{...g,ref:e,onKeyDown:ne(t.onKeyDown,u=>{u.key==="Home"?(i(u),u.preventDefault()):u.key==="End"?(l(u),u.preventDefault()):kt.concat(Nt).includes(u.key)&&(c(u),u.preventDefault())}),onPointerDown:ne(t.onPointerDown,u=>{const x=u.target;x.setPointerCapture(u.pointerId),u.preventDefault(),v.thumbs.has(x)?x.focus():a(u)}),onPointerMove:ne(t.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&n(u)}),onPointerUp:ne(t.onPointerUp,u=>{const x=u.target;x.hasPointerCapture(u.pointerId)&&(x.releasePointerCapture(u.pointerId),r(u))})})}),Dt="SliderTrack",_t=d.forwardRef((t,e)=>{const{__scopeSlider:s,...a}=t,n=Ae(Dt,s);return o.jsx(ee.span,{"data-disabled":n.disabled?"":void 0,"data-orientation":n.orientation,...a,ref:e})});_t.displayName=Dt;var qe="SliderRange",zt=d.forwardRef((t,e)=>{const{__scopeSlider:s,...a}=t,n=Ae(qe,s),r=Mt(qe,s),i=d.useRef(null),l=oe(e,i),c=n.values.length,g=n.values.map(x=>Ot(x,n.min,n.max)),v=c>1?Math.min(...g):0,u=100-Math.max(...g);return o.jsx(ee.span,{"data-orientation":n.orientation,"data-disabled":n.disabled?"":void 0,...a,ref:l,style:{...t.style,[r.startEdge]:v+"%",[r.endEdge]:u+"%"}})});zt.displayName=qe;var Qe="SliderThumb",Tt=d.forwardRef((t,e)=>{const s=Kn(t.__scopeSlider),[a,n]=d.useState(null),r=oe(e,l=>n(l)),i=d.useMemo(()=>a?s().findIndex(l=>l.ref.current===a):-1,[s,a]);return o.jsx(Zn,{...t,ref:r,index:i})}),Zn=d.forwardRef((t,e)=>{const{__scopeSlider:s,index:a,name:n,...r}=t,i=Ae(Qe,s),l=Mt(Qe,s),[c,g]=d.useState(null),v=oe(e,w=>g(w)),u=c?i.form||!!c.closest("form"):!0,x=St(c),y=i.values[a],C=y===void 0?0:Ot(y,i.min,i.max),k=Jn(a,i.values.length),j=x?.[l.size],f=j?ts(j,C,l.direction):0;return d.useEffect(()=>{if(c)return i.thumbs.add(c),()=>{i.thumbs.delete(c)}},[c,i.thumbs]),o.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${C}% + ${f}px)`},children:[o.jsx(Ze.ItemSlot,{scope:t.__scopeSlider,children:o.jsx(ee.span,{role:"slider","aria-label":t["aria-label"]||k,"aria-valuemin":i.min,"aria-valuenow":y,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...r,ref:v,style:y===void 0?{display:"none"}:t.style,onFocus:ne(t.onFocus,()=>{i.valueIndexToChangeRef.current=a})})}),u&&o.jsx(At,{name:n??(i.name?i.name+(i.values.length>1?"[]":""):void 0),form:i.form,value:y},a)]})});Tt.displayName=Qe;var qn="RadioBubbleInput",At=d.forwardRef(({__scopeSlider:t,value:e,...s},a)=>{const n=d.useRef(null),r=oe(n,a),i=Ct(e);return d.useEffect(()=>{const l=n.current;if(!l)return;const c=window.HTMLInputElement.prototype,v=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==e&&v){const u=new Event("input",{bubbles:!0});v.call(l,e),l.dispatchEvent(u)}},[i,e]),o.jsx(ee.input,{style:{display:"none"},...s,ref:r,defaultValue:e})});At.displayName=qn;function Qn(t=[],e,s){const a=[...t];return a[s]=e,a.sort((n,r)=>n-r)}function Ot(t,e,s){const r=100/(s-e)*(t-e);return wt(r,[0,100])}function Jn(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function es(t,e){if(t.length===1)return 0;const s=t.map(n=>Math.abs(n-e)),a=Math.min(...s);return s.indexOf(a)}function ts(t,e,s){const a=t/2,r=st([0,50],[0,a]);return(a-r(e)*s)*s}function ns(t){return t.slice(0,-1).map((e,s)=>t[s+1]-e)}function ss(t,e){if(e>0){const s=ns(t);return Math.min(...s)>=e}return!0}function st(t,e){return s=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const a=(e[1]-e[0])/(t[1]-t[0]);return e[0]+a*(s-t[0])}}function rs(t){return(String(t).split(".")[1]||"").length}function as(t,e){const s=Math.pow(10,e);return Math.round(t*s)/s}var Bt=Rt,os=_t,is=zt,ls=Tt;const le=d.forwardRef(({className:t,...e},s)=>o.jsxs(Bt,{ref:s,className:ce("relative flex w-full touch-none select-none items-center",t),...e,children:[o.jsx(os,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:o.jsx(is,{className:"absolute h-full bg-primary"})}),o.jsx(ls,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));le.displayName=Bt.displayName;var cs="Label",Lt=d.forwardRef((t,e)=>o.jsx(ee.label,{...t,ref:e,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(t.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Lt.displayName=cs;var $t=Lt;const ds=$n("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),J=d.forwardRef(({className:t,...e},s)=>o.jsx($t,{ref:s,className:ce(ds(),t),...e}));J.displayName=$t.displayName;const Ye=(t,e,s,a)=>Math.sqrt((s-t)**2+(a-e)**2),Ue=(t,e,s,a)=>Math.atan2(e-a,t-s),dt=t=>(t*180/Math.PI+360)%360,Ke=(t,e,s)=>{const a=s*e,n=t/60,r=a*(1-Math.abs(n%2-1));let i=0,l=0,c=0;n>=0&&n<1?[i,l]=[a,r]:n<2?[i,l]=[r,a]:n<3?[l,c]=[a,r]:n<4?[l,c]=[r,a]:n<5?[i,c]=[r,a]:[i,c]=[a,r];const g=s-a;return{r:Math.round((i+g)*255),g:Math.round((l+g)*255),b:Math.round((c+g)*255)}},ve=(t,e,s)=>{t/=255,e/=255,s/=255;const a=Math.max(t,e,s),n=Math.min(t,e,s),r=a-n;let i=0;r!==0&&(a===t?i=(e-s)/r%6:a===e?i=(s-t)/r+2:i=(t-e)/r+4),i=Math.round(i*60),i<0&&(i+=360);const l=a===0?0:r/a;return{h:i,s:l,v:a}},ut=(t,e,s)=>{const a=n=>`0${n.toString(16)}`.slice(-2);return`#${a(t)}${a(e)}${a(s)}`},ht=(t,e,s)=>{t/=255,e/=255,s/=255;const a=Math.max(t,e,s),n=Math.min(t,e,s);let r=0,i=0;const l=(a+n)/2;if(a!==n){const c=a-n;switch(i=l>.5?c/(2-a-n):c/(a+n),a){case t:r=(e-s)/c+(e<s?6:0);break;case e:r=(s-t)/c+2;break;case s:r=(t-e)/c+4;break}r/=6}return{h:Math.round(r*360),s:Math.round(i*100),l:Math.round(l*100)}},us=["#000000","#FFFFFF","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#808080"],ue={DEFAULT_SIZE:300,WHEEL_RADIUS_RATIO:.35,ALPHA_INNER_RADIUS_OFFSET:15,ALPHA_OUTER_RADIUS_OFFSET:10,INDICATOR_RADIUS:6,INDICATOR_BORDER_WIDTH:2},ft={COLOR_RING_TOLERANCE:{HUE:10,SATURATION_VALUE:.1},ANTI_ALIASING_EDGE_WIDTH:1};function hs({size:t=ue.DEFAULT_SIZE,onChange:e,initialColor:s={r:255,g:0,b:0,a:1},showEyedropper:a=!1,showBrightnessBar:n=!1,showColorRings:r=!1,pickerBgColor:i="#ffffff",colorRingsPalette:l=[...us],formats:c}){const g=d.useRef(null),v=d.useRef(null),[u,x]=d.useState(!1),[y,C]=d.useState(null),[k,j]=d.useState(!1),[f,w]=d.useState(()=>{const{h,s:m,v:b}=ve(s.r,s.g,s.b);return{h,s:m,v:b,a:s.a??1}}),{centerX:p,centerY:R,wheelRadius:E,alphaInnerRadius:A,alphaOuterRadius:P}=d.useMemo(()=>({centerX:t/2,centerY:t/2,wheelRadius:t*ue.WHEEL_RADIUS_RATIO,alphaInnerRadius:t*ue.WHEEL_RADIUS_RATIO+ue.ALPHA_INNER_RADIUS_OFFSET,alphaOuterRadius:t/2-ue.ALPHA_OUTER_RADIUS_OFFSET}),[t]),B=d.useMemo(()=>{const{r:h,g:m,b}=Ke(f.h,f.s,f.v),D=ut(h,m,b),{h:T,s:H,l:$}=ht(h,m,b);return{r:h,g:m,b,hex:D,rgbaString:`rgba(${h}, ${m}, ${b}, ${f.a.toFixed(2)})`,hslaString:`hsla(${T}, ${H}%, ${$}%, ${f.a.toFixed(2)})`}},[f]);d.useEffect(()=>{const h=window.devicePixelRatio||1,m=document.createElement("canvas"),b=t*h;m.width=b,m.height=b;const D=m.getContext("2d",{alpha:!0});if(!D)return;D.imageSmoothingEnabled=!0,D.imageSmoothingQuality="high",D.scale(h,h);const T=D.createImageData(t,t),H=T.data;for(let $=0;$<t;$++)for(let U=0;U<t;U++){const Y=Ye(U,$,p,R),Q=($*t+U)*4;if(Y<=E){const F=Ue(U,$,p,R),pe=dt(F),Pe=Math.min(1,Y/E),{r:Le,g:$e,b:Me}=Ke(pe,Pe,1);let Ie=255;Y>E-ft.ANTI_ALIASING_EDGE_WIDTH&&(Ie=Math.max(0,255*(E-Y))),H[Q]=Le,H[Q+1]=$e,H[Q+2]=Me,H[Q+3]=Ie}else H[Q+3]=0}D.putImageData(T,0,0),v.current=m},[t,p,R,E]);const te=d.useCallback(()=>{const h=g.current;if(!h)return;const m=h.getContext("2d",{alpha:!0});if(!m)return;m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high";const b=window.devicePixelRatio||1;m.save(),m.scale(b,b),m.clearRect(0,0,t,t),v.current&&m.drawImage(v.current,0,0),m.save(),m.beginPath(),m.arc(p,R,P,0,2*Math.PI),m.arc(p,R,A,0,2*Math.PI,!0),m.clip();const D=m.createConicGradient(-Math.PI/2,p,R);D.addColorStop(0,`rgba(${B.r}, ${B.g}, ${B.b}, 1)`),D.addColorStop(1,`rgba(${B.r}, ${B.g}, ${B.b}, 0)`),m.beginPath(),m.arc(p,R,P,0,2*Math.PI),m.fillStyle=D,m.fill(),m.restore();const T=(Q,F)=>{m.beginPath(),m.arc(Q,F,ue.INDICATOR_RADIUS,0,2*Math.PI),m.fillStyle="#fff",m.fill(),m.strokeStyle="#333",m.lineWidth=ue.INDICATOR_BORDER_WIDTH,m.stroke()},H=f.h*Math.PI/180,$=f.s*E;T(p+$*Math.cos(H),R+$*Math.sin(H));const U=(1-f.a)*2*Math.PI-Math.PI/2,Y=(A+P)/2;T(p+Y*Math.cos(U),R+Y*Math.sin(U)),m.restore()},[t,f,B,p,R,E,A,P]);d.useEffect(()=>{const h=g.current;if(!h)return;const m=window.devicePixelRatio||1,b=t,D=t;h.width=b*m,h.height=D*m,h.style.width=`${b}px`,h.style.height=`${D}px`},[t]),d.useEffect(()=>{te()},[te]);const L=d.useCallback(h=>{const{r:m,g:b,b:D}=Ke(h.h,h.s,h.v),{h:T,s:H,l:$}=ht(m,b,D),U={rgba:{r:m,g:b,b:D,a:h.a},rgb:{r:m,g:b,b:D},hex:ut(m,b,D),hsl:{h:T,s:H,l:$},hsla:{h:T,s:H,l:$,a:h.a},hsv:{h:Math.round(h.h),s:Math.round(h.s*100),v:Math.round(h.v*100)},hsva:{h:Math.round(h.h),s:Math.round(h.s*100),v:Math.round(h.v*100),a:h.a}},Y={};c.forEach(Q=>{Y[Q]=U[Q]}),e?.(Y)},[e,c]),O=d.useCallback(h=>{const m=g.current;if(!m)return{x:0,y:0};const b=m.getBoundingClientRect(),D="touches"in h?h.touches[0].clientX:h.clientX,T="touches"in h?h.touches[0].clientY:h.clientY;return{x:D-b.left,y:T-b.top}},[]),G=d.useCallback((h,m)=>{const b=Ye(h,m,p,R),D=Ue(h,m,p,R),T=dt(D),H=Math.min(1,b/E),$={...f,h:T,s:H};w($),L($)},[p,R,E,f,L]),V=d.useCallback((h,m)=>{let b=Ue(h,m,p,R)+Math.PI/2;b<0&&(b+=2*Math.PI);const D=Math.max(0,Math.min(1,1-b/(2*Math.PI))),T={...f,a:D};w(T),L(T)},[p,R,f,L]),Z=d.useCallback(h=>{const{x:m,y:b}=O(h),D=Ye(m,b,p,R);D<=E?(x(!0),C("color"),G(m,b)):D>=A&&D<=P&&(x(!0),C("alpha"),V(m,b))},[O,p,R,E,A,P,G,V]),q=d.useCallback(h=>{if(!u)return;"cancelable"in h&&h.cancelable&&h.preventDefault();const{x:m,y:b}=O(h);y==="color"?G(m,b):y==="alpha"&&V(m,b)},[u,y,O,G,V]),N=d.useCallback(()=>{x(!1),C(null)},[]);d.useEffect(()=>{if(u)return document.addEventListener("mousemove",q),document.addEventListener("mouseup",N),document.addEventListener("touchmove",q,{passive:!1}),document.addEventListener("touchend",N),()=>{document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",N),document.removeEventListener("touchmove",q),document.removeEventListener("touchend",N)}},[u,q,N]),d.useEffect(()=>{j(!0)},[]);const S=d.useCallback(async()=>{if("EyeDropper"in window)try{const h=(await new window.EyeDropper().open()).sRGBHex,m=parseInt(h.slice(1,3),16),b=parseInt(h.slice(3,5),16),D=parseInt(h.slice(5,7),16),T={...ve(m,b,D),a:f.a};w(T),L(T);return}catch{console.log("Native eyedropper cancelled");return}try{const h=await navigator.mediaDevices.getDisplayMedia({video:!0}),m=document.createElement("video");m.srcObject=h,m.play(),await new Promise(F=>{m.onloadedmetadata=F});const b=document.createElement("div");b.style.position="fixed",b.style.top="0",b.style.left="0",b.style.width="100vw",b.style.height="100vh",b.style.backgroundColor="rgba(0,0,0,0.3)",b.style.cursor="crosshair",b.style.zIndex="9999",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center";const D=document.createElement("div");D.innerHTML=`
        <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; max-width: 300px;">
          <h3 style="margin: 0 0 10px 0;">Color Picker</h3>
          <p style="margin: 0 0 15px 0;">Move your cursor/pen over any area and click to pick a color</p>
          <button id="cancel-picker" style="padding: 8px 16px; background: #ccc; border: none; border-radius: 4px; cursor: pointer;">Cancel</button>
        </div>
      `,b.appendChild(D);const T=document.createElement("canvas"),H=T.getContext("2d");T.width=m.videoWidth,T.height=m.videoHeight,document.body.appendChild(b);const $=(F,pe)=>{H?.drawImage(m,0,0);const Pe=b.getBoundingClientRect(),Le=Math.floor(F/Pe.width*T.width),$e=Math.floor(pe/Pe.height*T.height),Me=H?.getImageData(Le,$e,1,1);if(Me){const[Ie,wn,Cn]=Me.data,ct={...ve(Ie,wn,Cn),a:f.a};w(ct),L(ct)}U()},U=()=>{h.getTracks().forEach(F=>F.stop()),document.body.removeChild(b)},Y=F=>{F.key==="Escape"?(document.removeEventListener("keydown",Y),U()):F.key==="Enter"&&$(window.innerWidth/2,window.innerHeight/2)},Q=()=>{document.removeEventListener("keydown",Y),U()};b.addEventListener("click",F=>{F.target===b&&$(F.clientX,F.clientY)}),b.addEventListener("touchend",F=>{if(F.preventDefault(),F.changedTouches.length>0){const pe=F.changedTouches[0];$(pe.clientX,pe.clientY)}}),b.addEventListener("pointerup",F=>{F.target===b&&$(F.clientX,F.clientY)}),document.addEventListener("keydown",Y),document.getElementById("cancel-picker")?.addEventListener("click",Q)}catch(h){console.warn("Screen capture not supported or denied:",h);const m=document.createElement("input");m.type="color",m.style.position="absolute",m.style.left="-9999px",document.body.appendChild(m),m.addEventListener("change",b=>{const D=b.target.value,T=parseInt(D.slice(1,3),16),H=parseInt(D.slice(3,5),16),$=parseInt(D.slice(5,7),16),U={...ve(T,H,$),a:f.a};w(U),L(U),document.body.removeChild(m)}),m.click()}},[f.a,L]),M=d.useCallback(h=>{const m=parseFloat(h.target.value),b={...f,v:m};w(b),L(b)},[f,L]),I=d.useCallback(h=>{const m=parseInt(h.slice(1,3),16),b=parseInt(h.slice(3,5),16),D=parseInt(h.slice(5,7),16),{h:T,s:H,v:$}=ve(m,b,D),U={...f,h:T,s:H,v:$};w(U),L(U)},[f,L]),z=d.useCallback(h=>{const m=parseInt(h.slice(1,3),16),b=parseInt(h.slice(3,5),16),D=parseInt(h.slice(5,7),16),{h:T,s:H,v:$}=ve(m,b,D),{HUE:U,SATURATION_VALUE:Y}=ft.COLOR_RING_TOLERANCE;return Math.abs(f.h-T)<U&&Math.abs(f.s-H)<Y&&Math.abs(f.v-$)<Y},[f.h,f.s,f.v]),_=d.useMemo(()=>{const h=a&&k,m=r&&l.length>0,b=n;return{hasEyedropper:h,hasColorRings:m,hasBrightnessBar:b,isCompactLayout:!m&&!b,needsFlexLayout:h||m||b}},[a,k,r,l.length,n]);return o.jsx("div",{className:"z-color-picker",style:{width:"fit-content"},children:o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsx("canvas",{ref:g,className:"shadow-lg",style:{cursor:u?"grabbing":"grab",touchAction:"none",borderRadius:"50%",backgroundColor:i},onMouseDown:Z,onTouchStart:Z}),(_.hasEyedropper||_.hasColorRings||_.hasBrightnessBar)&&o.jsxs("div",{className:"flex items-center gap-6",children:[_.hasEyedropper&&o.jsx("button",{onClick:S,className:"flex items-center justify-center w-12 h-12 border border-gray-300 rounded-full shadow-sm transition-all duration-200 hover:shadow-md",title:"Pick color from screen",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256",id:"eyedropper",width:30,hanging:30,children:[o.jsx("rect",{width:"256",height:"256",fill:"none"}),o.jsx("path",{fill:"none",stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8",d:"M179.799,115.799l4.88728,4.88728a16,16,0,0,1,0,22.62742l-7.02944,7.02944a8,8,0,0,1-11.3137,0l-60.6863-60.6863a8,8,0,0,1,0-11.3137l7.02944-7.02944a16,16,0,0,1,22.62742,0l4.8873,4.8873,27.58813-27.58813c10.78822-10.78822,28.36591-11.4491,39.44579-.96065A28.00039,28.00039,0,0,1,207.799,87.799Z"}),o.jsx("path",{fill:"none",stroke:"#000","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"8",d:"M158.62742,142.62742l-56,56a31.98729,31.98729,0,0,1-30.91154,8.28721L48.31361,217.131A8,8,0,0,1,39.456,215.456h0a5.74381,5.74381,0,0,1-1.20256-6.35955l10.832-24.81212a31.9873,31.9873,0,0,1,8.28715-30.91177l56-56"})]})}),(_.hasColorRings||_.hasBrightnessBar)&&o.jsxs("div",{className:"flex flex-col gap-3",style:{minWidth:t*.8},children:[_.hasColorRings&&o.jsx("div",{className:"flex flex-col gap-2",children:_.hasBrightnessBar?o.jsx("div",{className:"flex gap-2 justify-center",children:l.slice(0,8).map((h,m)=>{const b=z(h);return o.jsx("button",{onClick:()=>I(h),className:`w-6 h-6 rounded-full border-2 transition-all duration-200 hover:scale-110 shadow-sm ${b?"border-gray-500 border-1 scale-110":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:h},title:h},`single-row-${m}`)})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex gap-2 justify-center",children:l.slice(0,Math.ceil(l.length/2)).map((h,m)=>{const b=z(h);return o.jsx("button",{onClick:()=>I(h),className:`w-6 h-6 rounded-full border-2 transition-all duration-200 hover:scale-110 shadow-sm ${b?"border-blue-500 border-4 scale-110":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:h},title:h},`row1-${m}`)})}),o.jsx("div",{className:"flex gap-2 justify-center",children:l.slice(Math.ceil(l.length/2)).map((h,m)=>{const b=z(h);return o.jsx("button",{onClick:()=>I(h),className:`w-6 h-6 rounded-full border-2 transition-all duration-200 hover:scale-110 shadow-sm ${b?"border-blue-500 border-4 scale-110":"border-gray-300 hover:border-gray-500"}`,style:{backgroundColor:h},title:h},`row2-${m}`)})})]})}),_.hasBrightnessBar&&o.jsx("div",{className:"relative",children:o.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:f.v,onChange:M,className:"w-full h-3 appearance-none rounded-lg cursor-pointer shadow-inner range-thumb",style:{background:`linear-gradient(to right, 
                        hsl(${f.h}, ${f.s*100}%, 0%), 
                        hsl(${f.h}, ${f.s*100}%, 50%), 
                        hsl(${f.h}, ${f.s*100}%, 100%))`}})})]})]})]})})}/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ps=W("arrow-left",fs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["circle",{cx:"9",cy:"9",r:"7",key:"p2h5vp"}],["circle",{cx:"15",cy:"15",r:"7",key:"19ennj"}]],gs=W("blend",ms);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ys=W("chevron-left",xs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],bs=W("eraser",vs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]],Ve=W("file-image",Ss);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Cs=W("file",ws);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Ns=W("maximize-2",ks);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Es=W("move",js);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ps=W("pen",Rs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Is=W("pencil",Ms);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],_s=W("redo-2",Ds);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ts=W("save",zs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Os=W("sparkles",As);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],Ls=W("square-dot",Bs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Fs=W("square",$s);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Ys=W("undo-2",Hs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ks=W("x",Us);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Gs=W("zoom-in",Vs);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ws=W("zoom-out",Xs),Zs=Re(({onSave:t,onExport:e,onCollapse:s,className:a,isDrawingMode:n,onForceDrawingMode:r})=>{const i=Ee(),[l,c]=d.useState(!1);ze();const g=[{value:"white",label:"White",icon:o.jsx(Fs,{className:"w-4 h-4"})},{value:"transparent",label:"Transparent",icon:o.jsx(Ls,{className:"w-4 h-4"})},{value:"grid",label:"Grid",icon:o.jsx(Pn,{className:"w-4 h-4"})}],v=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00"],u=P=>{i.setColor(P.hex)},x=P=>{!n&&r&&r(),i.setPenSize(P[0])},y=P=>{!n&&r&&r(),i.setEraserSize(P[0])},C=P=>{i.setBackground(P)},k=()=>{c(!0)},j=()=>{i.clear(),c(!1)},f=()=>{c(!1)},w=P=>{!n&&r&&r(),i.setBrushSettings({thinning:P[0]})},p=P=>{!n&&r&&r(),i.setBrushSettings({smoothing:P[0]})},R=P=>{!n&&r&&r(),i.setBrushSettings({streamline:P[0]})},E=P=>{!n&&r&&r(),i.setBrushSettings({taperStart:P[0]})},A=P=>{!n&&r&&r(),i.setBrushSettings({taperEnd:P[0]})};return o.jsxs(o.Fragment,{children:[l&&kn.createPortal(o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-white/20 backdrop-blur-sm",children:o.jsxs("div",{className:"bg-white rounded shadow-lg p-6 w-80 border border-gray-200",children:[o.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Clear Canvas?"}),o.jsx("p",{className:"mb-6 text-sm text-gray-700",children:"Are you sure you want to clear the canvas? This action cannot be undone."}),o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(X,{variant:"outline",onClick:f,children:"Cancel"}),o.jsx(X,{variant:"destructive",onClick:j,children:"Clear"})]})]})}),document.body),o.jsxs("div",{className:`w-80 bg-white border-r border-gray-200 flex flex-col ${a}`,children:[o.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[o.jsx("div",{children:o.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Drawing Tools"})}),s&&o.jsx(X,{variant:"ghost",size:"sm",onClick:s,className:"p-2",children:o.jsx(ys,{className:"w-4 h-4"})})]}),o.jsxs("div",{className:"h-[88vh] overflow-y-auto p-4 space-y-6",children:[o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsxs(xe,{className:"text-sm font-medium",children:[i.currentBrushStyle==="eraser"?"Eraser":"Brush"," ","Settings"]})}),o.jsxs(ye,{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Size:"," ",o.jsxs("span",{className:"font-semibold",children:[i.currentBrushStyle==="eraser"?i.eraserSize:i.currentSize,"px"]})]}),o.jsx(le,{value:i.currentBrushStyle==="eraser"?[i.eraserSize]:[i.currentSize],onValueChange:i.currentBrushStyle==="eraser"?y:x,min:1,max:i.currentBrushStyle==="eraser"?100:50,step:1,className:"w-full"})]}),i.currentBrushStyle!=="eraser"&&o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Opacity:"," ",Math.round((i.brushSettings.opacity??1)*100),"%"]}),o.jsx(le,{value:[i.brushSettings.opacity??1],onValueChange:P=>{!n&&r&&r(),i.setBrushSettings({opacity:P[0]})},min:0,max:1,step:.05,className:"w-full"})]})]})]}),i.currentBrushStyle==="ink"&&o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsx(xe,{className:"text-sm font-medium",children:"Pen Settings"})}),o.jsxs(ye,{className:"space-y-4",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Thinning:"," ",(i.brushSettings.thinning*100).toFixed(0),"%"]}),o.jsx(le,{value:[i.brushSettings.thinning],onValueChange:w,min:0,max:1,step:.1,className:"w-full"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Smoothing:"," ",(i.brushSettings.smoothing*100).toFixed(0),"%"]}),o.jsx(le,{value:[i.brushSettings.smoothing],onValueChange:p,min:0,max:1,step:.1,className:"w-full"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Streamline:"," ",(i.brushSettings.streamline*100).toFixed(0),"%"]}),o.jsx(le,{value:[i.brushSettings.streamline],onValueChange:R,min:0,max:1,step:.1,className:"w-full"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Taper Start: ",i.brushSettings.taperStart]}),o.jsx(le,{value:[i.brushSettings.taperStart],onValueChange:E,min:0,max:100,step:1,className:"w-full"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs font-medium text-gray-600",children:["Taper End: ",i.brushSettings.taperEnd]}),o.jsx(le,{value:[i.brushSettings.taperEnd],onValueChange:A,min:0,max:100,step:1,className:"w-full"})]})]})]}),o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsxs(xe,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(En,{className:"w-4 h-4"}),"Color"]})}),o.jsx(ye,{className:"space-y-4 overflow-auto",children:o.jsx(hs,{initialColor:{r:0,g:0,b:0,a:1},size:220,formats:["hex"],onChange:u,showColorRings:!0,showBrightnessBar:!0,colorRingsPalette:v})})]}),o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsx(xe,{className:"text-sm font-medium",children:"Background"})}),o.jsx(ye,{children:o.jsx("div",{className:"grid grid-cols-3 gap-2",children:g.map(P=>o.jsxs("button",{onClick:()=>C(P.value),className:`flex flex-col items-center gap-1 p-3 rounded border-2 transition-all ${i.background===P.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-assNam00"}`,children:[P.icon,o.jsx("span",{className:"text-xs",children:P.label})]},P.value))})})]}),o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsx(xe,{className:"text-sm font-medium",children:"Actions"})}),o.jsxs(ye,{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsxs(X,{variant:"outline",size:"sm",onClick:i.undo,disabled:!i.canUndo,className:"flex-1 bg-transparent",children:[o.jsx(Ys,{className:"w-4 h-4 mr-1"}),"Undo"]}),o.jsxs(X,{variant:"outline",size:"sm",onClick:i.redo,disabled:!i.canRedo,className:"flex-1 bg-transparent",children:[o.jsx(_s,{className:"w-4 h-4 mr-1"}),"Redo"]})]}),o.jsxs(X,{variant:"outline",size:"sm",onClick:k,className:"w-full bg-transparent",children:[o.jsx(Rn,{className:"w-4 h-4 mr-2"}),"Clear Canvas"]}),o.jsxs(X,{onClick:t,className:"w-full",disabled:i.isEmpty,children:[o.jsx(Ts,{className:"w-4 h-4 mr-2"}),"Save to Vault"]})]})]}),o.jsxs(me,{children:[o.jsx(ge,{className:"pb-3",children:o.jsxs(xe,{className:"text-sm font-medium flex items-center gap-2",children:[o.jsx(We,{className:"w-4 h-4"}),"Export"]})}),o.jsx(ye,{children:o.jsxs(X,{onClick:e,disabled:i.isEmpty,className:"w-full",children:[o.jsx(We,{className:"w-4 h-4 mr-2"}),"Export Drawing"]})})]})]})]})]})});function pt(t,e,s,a=n=>n){return t*a(.5-e*(.5-s))}function qs(t){return[-t[0],-t[1]]}function ae(t,e){return[t[0]+e[0],t[1]+e[1]]}function se(t,e){return[t[0]-e[0],t[1]-e[1]]}function re(t,e){return[t[0]*e,t[1]*e]}function Qs(t,e){return[t[0]/e,t[1]/e]}function Ce(t){return[t[1],-t[0]]}function mt(t,e){return t[0]*e[0]+t[1]*e[1]}function Js(t,e){return t[0]===e[0]&&t[1]===e[1]}function er(t){return Math.hypot(t[0],t[1])}function tr(t){return t[0]*t[0]+t[1]*t[1]}function gt(t,e){return tr(se(t,e))}function Ft(t){return Qs(t,er(t))}function nr(t,e){return Math.hypot(t[1]-e[1],t[0]-e[0])}function ke(t,e,s){let a=Math.sin(s),n=Math.cos(s),r=t[0]-e[0],i=t[1]-e[1],l=r*n-i*a,c=r*a+i*n;return[l+e[0],c+e[1]]}function Je(t,e,s){return ae(t,re(se(e,t),s))}function xt(t,e,s){return ae(t,re(e,s))}var{min:be,PI:sr}=Math,yt=.275,Ne=sr+1e-4;function rr(t,e={}){let{size:s=16,smoothing:a=.5,thinning:n=.5,simulatePressure:r=!0,easing:i=S=>S,start:l={},end:c={},last:g=!1}=e,{cap:v=!0,easing:u=S=>S*(2-S)}=l,{cap:x=!0,easing:y=S=>--S*S*S+1}=c;if(t.length===0||s<=0)return[];let C=t[t.length-1].runningLength,k=l.taper===!1?0:l.taper===!0?Math.max(s,C):l.taper,j=c.taper===!1?0:c.taper===!0?Math.max(s,C):c.taper,f=Math.pow(s*a,2),w=[],p=[],R=t.slice(0,10).reduce((S,M)=>{let I=M.pressure;if(r){let z=be(1,M.distance/s),_=be(1,1-z);I=be(1,S+(_-S)*(z*yt))}return(S+I)/2},t[0].pressure),E=pt(s,n,t[t.length-1].pressure,i),A,P=t[0].vector,B=t[0].point,te=B,L=B,O=te,G=!1;for(let S=0;S<t.length;S++){let{pressure:M}=t[S],{point:I,vector:z,distance:_,runningLength:h}=t[S];if(S<t.length-1&&C-h<3)continue;if(n){if(r){let Y=be(1,_/s),Q=be(1,1-Y);M=be(1,R+(Q-R)*(Y*yt))}E=pt(s,n,M,i)}else E=s/2;A===void 0&&(A=E);let m=h<k?u(h/k):1,b=C-h<j?y((C-h)/j):1;E=Math.max(.01,E*Math.min(m,b));let D=(S<t.length-1?t[S+1]:t[S]).vector,T=S<t.length-1?mt(z,D):1,H=mt(z,P)<0&&!G,$=T!==null&&T<0;if(H||$){let Y=re(Ce(P),E);for(let Q=1/13,F=0;F<=1;F+=Q)L=ke(se(I,Y),I,Ne*F),w.push(L),O=ke(ae(I,Y),I,Ne*-F),p.push(O);B=L,te=O,$&&(G=!0);continue}if(G=!1,S===t.length-1){let Y=re(Ce(z),E);w.push(se(I,Y)),p.push(ae(I,Y));continue}let U=re(Ce(Je(D,z,T)),E);L=se(I,U),(S<=1||gt(B,L)>f)&&(w.push(L),B=L),O=ae(I,U),(S<=1||gt(te,O)>f)&&(p.push(O),te=O),R=M,P=z}let V=t[0].point.slice(0,2),Z=t.length>1?t[t.length-1].point.slice(0,2):ae(t[0].point,[1,1]),q=[],N=[];if(t.length===1){if(!(k||j)||g){let S=xt(V,Ft(Ce(se(V,Z))),-(A||E)),M=[];for(let I=1/13,z=I;z<=1;z+=I)M.push(ke(S,V,Ne*2*z));return M}}else{if(!(k||j&&t.length===1))if(v)for(let M=1/13,I=M;I<=1;I+=M){let z=ke(p[0],V,Ne*I);q.push(z)}else{let M=se(w[0],p[0]),I=re(M,.5),z=re(M,.51);q.push(se(V,I),se(V,z),ae(V,z),ae(V,I))}let S=Ce(qs(t[t.length-1].vector));if(j||k&&t.length===1)N.push(Z);else if(x){let M=xt(Z,S,E);for(let I=1/29,z=I;z<1;z+=I)N.push(ke(M,Z,Ne*3*z))}else N.push(ae(Z,re(S,E)),ae(Z,re(S,E*.99)),se(Z,re(S,E*.99)),se(Z,re(S,E)))}return w.concat(N,p.reverse(),q)}function ar(t,e={}){var s;let{streamline:a=.5,size:n=16,last:r=!1}=e;if(t.length===0)return[];let i=.15+(1-a)*.85,l=Array.isArray(t[0])?t:t.map(({x:y,y:C,pressure:k=.5})=>[y,C,k]);if(l.length===2){let y=l[1];l=l.slice(0,-1);for(let C=1;C<5;C++)l.push(Je(l[0],y,C/4))}l.length===1&&(l=[...l,[...ae(l[0],[1,1]),...l[0].slice(2)]]);let c=[{point:[l[0][0],l[0][1]],pressure:l[0][2]>=0?l[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],g=!1,v=0,u=c[0],x=l.length-1;for(let y=1;y<l.length;y++){let C=r&&y===x?l[y].slice(0,2):Je(u.point,l[y],i);if(Js(u.point,C))continue;let k=nr(C,u.point);if(v+=k,y<x&&!g){if(v<n)continue;g=!0}u={point:C,pressure:l[y][2]>=0?l[y][2]:.5,vector:Ft(se(u.point,C)),distance:k,runningLength:v},c.push(u)}return c[0].vector=((s=c[1])==null?void 0:s.vector)||[0,0],c}function je(t,e={}){return rr(ar(t,e),e)}class or{key="ink";render(e,s,a){const n=s.points.map(c=>[c.x,c.y,c.pressure??.5]),r=je(n,{size:s.size,thinning:a?.thinning??.5,smoothing:a?.smoothing??.5,streamline:a?.streamline??.5,easing:a?.easing??(c=>c),start:a?.start??{taper:0},end:a?.end??{taper:0},last:!0});if(r.length<3)return;const i=new Path2D(this.toPathData(r)),l=e.globalAlpha;e.fillStyle=s.color,e.globalAlpha=(s.opacity??1)*l,e.fill(i),e.globalAlpha=l}toPathData(e){const s=(c,g)=>(c+g)/2,a=e.length;let n=e[0],r=e[1],i=e[2],l=`M${n[0]},${n[1]} Q${r[0]},${r[1]} ${s(r[0],i[0])},${s(r[1],i[1])} T`;for(let c=2;c<a-1;c++)n=e[c],r=e[c+1],l+=`${s(n[0],r[0])},${s(n[1],r[1])} `;return l+="Z",l}}const Ge=t=>{const e=Math.sin(t)*1e4;return e-Math.floor(e)};class ir{key="spray";render(e,s){const a=s.size,n=e.globalAlpha;e.fillStyle=s.color,e.globalAlpha=(s.opacity??1)*n;for(let r=0;r<s.points.length;r++){const{x:i,y:l,pressure:c=.5}=s.points[r],g=a*c,v=Math.max(3,g*.3);for(let u=0;u<v;u++){const x=i*1e3+l*100+u*10+r,y=i*100+l*1e3+u*5+r*2,C=i*10+l*10+u+r*3,k=Ge(x)*Math.PI*2,j=Ge(y)*g*.8,f=i+Math.cos(k)*j,w=l+Math.sin(k)*j,p=Ge(C)*2+.5;e.beginPath(),e.arc(f,w,p,0,Math.PI*2),e.fill()}}e.globalAlpha=n}}const vt=t=>{const e=Math.sin(t)*1e4;return e-Math.floor(e)};class lr{key="texture";render(e,s,a){const n=e.globalAlpha,r=s.points.map(i=>[i.x,i.y,i.pressure??.5]);for(let i=0;i<3;i++){const l=.3-i*.1,c=i*2,g=r.map(([x,y,C],k)=>{const j=x*1e3+y*100+i*50+k,f=x*100+y*1e3+i*25+k*2;return[x+(vt(j)-.5)*c,y+(vt(f)-.5)*c,C]}),v=je(g,{size:s.size*(.8+i*.1),thinning:a?.thinning??.7,smoothing:a?.smoothing??.5,streamline:a?.streamline??.5,start:{cap:!1,taper:10},end:{cap:!1,taper:10},last:!0});if(v.length<3)continue;e.globalAlpha=(s.opacity??1)*l*n;const u=new Path2D(this.toPathData(v));e.fillStyle=s.color,e.fill(u)}e.globalAlpha=n}toPathData(e){const s=(c,g)=>(c+g)/2,a=e.length;let n=e[0],r=e[1],i=e[2],l=`M${n[0]},${n[1]} Q${r[0]},${r[1]} ${s(r[0],i[0])},${s(r[1],i[1])} T`;for(let c=2;c<a-1;c++)n=e[c],r=e[c+1],l+=`${s(n[0],r[0])},${s(n[1],r[1])} `;return l+="Z",l}}class cr{constructor(e=20){this.gridSize=e}draw(e,s,a){e.clearRect(0,0,s.width,s.height),e.save(),e.fillStyle="#ffffff",e.fillRect(0,0,s.width,s.height),e.translate(a.panX,a.panY),e.scale(a.zoom,a.zoom),e.strokeStyle="#f0f0f0",e.lineWidth=1/a.zoom;const n=(0-a.panX)/a.zoom,r=(s.width-a.panX)/a.zoom,i=(0-a.panY)/a.zoom,l=(s.height-a.panY)/a.zoom,c=Math.floor(n/this.gridSize)*this.gridSize,g=Math.ceil(r/this.gridSize)*this.gridSize,v=Math.floor(i/this.gridSize)*this.gridSize,u=Math.ceil(l/this.gridSize)*this.gridSize;for(let x=c;x<=g;x+=this.gridSize)e.beginPath(),e.moveTo(x,i-this.gridSize),e.lineTo(x,l+this.gridSize),e.stroke();for(let x=v;x<=u;x+=this.gridSize)e.beginPath(),e.moveTo(n-this.gridSize,x),e.lineTo(r+this.gridSize,x),e.stroke();e.restore()}}class dr{brushes=new Map;register(e){this.brushes.set(e.key,e)}get(e){return this.brushes.get(e)}}class ur{constructor(e,s){this.root=e,this.config=s,this.bg=document.createElement("canvas"),this.fg=document.createElement("canvas"),this.ui=document.createElement("canvas"),Object.assign(this.bg.style,{position:"absolute",inset:"0",width:"100%",height:"100%"}),Object.assign(this.fg.style,{position:"absolute",inset:"0",width:"100%",height:"100%"}),Object.assign(this.ui.style,{position:"absolute",inset:"0",width:"100%",height:"100%",pointerEvents:"none"}),this.root.appendChild(this.bg),this.root.appendChild(this.fg),this.root.appendChild(this.ui);const a=this.bg.getContext("2d"),n=this.fg.getContext("2d"),r=this.ui.getContext("2d");if(!a||!n||!r)throw new Error("Failed to get 2d context");this.bgCtx=a,this.fgCtx=n,this.uiCtx=r,this.background=s.background,this.registry.register(new or),this.registry.register(new ir),this.registry.register(new lr),this.resize(),window.addEventListener("resize",this.resize),this.loop()}bg;fg;ui;bgCtx;fgCtx;uiCtx;pz={panX:0,panY:0,zoom:1};registry=new dr;grid=new cr;rafId=null;invalid=!0;background;preview=null;cursor={visible:!1};destroy=()=>{window.removeEventListener("resize",this.resize),this.rafId&&cancelAnimationFrame(this.rafId),this.root.removeChild(this.bg),this.root.removeChild(this.fg),this.root.removeChild(this.ui)};setPanZoom(e){this.pz={...this.pz,...e},this.invalidate()}setBackground(e){this.background=e,this.invalidate()}setPreviewStroke(e){this.preview=e,this.invalidate()}setCursor(e){this.cursor=e,this.invalidate()}invalidate=()=>{this.invalid=!0,this.config.onInvalidate?.()};resize=()=>{const e=this.root.getBoundingClientRect(),s=Math.max(1,window.devicePixelRatio||1);for(const a of[this.bg,this.fg,this.ui])a.width=Math.floor(e.width*s),a.height=Math.floor(e.height*s),a.style.width=`${e.width}px`,a.style.height=`${e.height}px`,a.getContext("2d").setTransform(s,0,0,s,0,0);this.invalidate()};loop=()=>{this.invalid&&(this.render(),this.invalid=!1),this.rafId=requestAnimationFrame(this.loop)};render(){this.renderBackground(),this.renderStrokes(),this.renderOverlay()}renderBackground(){const e=this.bgCtx,s=this.bg;e.clearRect(0,0,s.width,s.height),this.background==="white"?(e.fillStyle="#ffffff",e.fillRect(0,0,s.width,s.height)):this.background==="grid"&&this.grid.draw(e,s,this.pz)}renderStrokes(){const e=this.fgCtx,s=this.fg;e.clearRect(0,0,s.width,s.height),e.save(),e.translate(this.pz.panX,this.pz.panY),e.scale(this.pz.zoom,this.pz.zoom);const a=this.config.getStrokes();for(const n of a)this.renderStroke(e,n);this.preview&&this.renderStroke(e,this.preview),e.restore()}renderStroke(e,s){const a=s.brushStyle==="eraser"?"destination-out":"source-over",n=e.globalCompositeOperation;e.globalCompositeOperation=a;const r=s.brushStyle==="eraser"?"ink":s.brushStyle,i=this.registry.get(r);if(!i)return;const l=this.config.getBrushOptions?.(r,s.size);i.render(e,s,l),e.globalCompositeOperation=n}renderOverlay(){const e=this.uiCtx,s=this.ui;e.clearRect(0,0,s.width,s.height),!(!this.cursor.visible||this.cursor.x==null||this.cursor.y==null||this.cursor.r==null)&&(e.save(),e.strokeStyle="#666666",e.lineWidth=2,e.setLineDash([5,5]),e.beginPath(),e.arc(this.cursor.x,this.cursor.y,this.cursor.r,0,Math.PI*2),e.stroke(),e.restore())}}const Xe=t=>{switch(t){case"easeIn":return e=>e*e;case"easeOut":return e=>1-Math.pow(1-e,2);case"easeInOut":return e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2;default:return e=>e}};function hr(t){return function(s,a){const n={size:a,thinning:t.thinning,smoothing:t.smoothing,streamline:t.streamline};switch(s){case"ink":return{...n,easing:Xe(t.easing),start:{taper:t.taperStart,easing:Xe(t.easing)},end:{taper:t.taperEnd,easing:Xe(t.easing)}};case"eraser":return{...n,thinning:.3,smoothing:.6,streamline:.6,start:{cap:!0,taper:0,easing:r=>r},end:{cap:!0,taper:0,easing:r=>r}};case"spray":return{...n,thinning:.8,smoothing:.3,streamline:.3,start:{cap:!1,taper:0,easing:r=>r},end:{cap:!1,taper:0,easing:r=>r}};case"texture":return{...n,thinning:.7,smoothing:.5,streamline:.5,start:{cap:!1,taper:10,easing:r=>r},end:{cap:!1,taper:10,easing:r=>r}};default:return n}}}const fr=Re(({isDrawingMode:t,className:e,width:s,height:a})=>{const n=Ee(),r=d.useRef(null),i=d.useRef(null),l=d.useRef("none"),c=d.useRef(null),g=d.useRef(!1),v=d.useRef(0),[u,x]=d.useState(!1),[y,C]=d.useState(!1),[k,j]=d.useState([]),[f,w]=d.useState(null),[p,R]=d.useState(!1),[E,A]=d.useState(null);d.useEffect(()=>{const N=r.current;if(!N)return;const S=new ur(N,{background:n.background,getStrokes:()=>n.strokes,getBrushOptions:(M,I)=>hr(n.brushSettings)(M,I)});return S.setPanZoom({panX:n.panX,panY:n.panY,zoom:n.zoom}),i.current=S,()=>{S.destroy(),i.current=null}},[]),d.useEffect(()=>{i.current?.setBackground(n.background),i.current?.invalidate()},[n.background]),d.useEffect(()=>{i.current?.setPanZoom({panX:n.panX,panY:n.panY,zoom:n.zoom})},[n.panX,n.panY,n.zoom]),d.useEffect(()=>{const N=i.current;N&&(N.setPreviewStroke(null),N.invalidate())},[n.renderVersion]);const P=d.useCallback((N,S)=>{const M=r.current;if(!M)return{x:0,y:0,pressure:.5};const I=M.getBoundingClientRect(),z=N-I.left,_=S-I.top,h=(z-n.panX)/n.zoom,m=(_-n.panY)/n.zoom;return{x:h,y:m,pressure:.5}},[n.panX,n.panY,n.zoom]),B=d.useRef(null),te=d.useCallback(()=>{i.current&&(B.current&&cancelAnimationFrame(B.current),B.current=requestAnimationFrame(()=>{if(i.current){if(k.length>1){const S={id:"temp",points:k.map(M=>({x:M.x,y:M.y,pressure:M.pressure})),color:n.currentColor,size:n.currentBrushStyle==="eraser"?n.eraserSize:n.currentSize,opacity:n.brushSettings.opacity??1,brushStyle:n.currentBrushStyle,timestamp:Date.now()};i.current.setPreviewStroke(S)}else i.current.setPreviewStroke(null);i.current.invalidate(),B.current=null}}))},[i.current,k,n.currentBrushStyle,n.currentColor,n.currentSize,n.eraserSize,n.brushSettings.opacity]);d.useEffect(()=>{const N=_=>{_.code==="Space"&&!_.repeat&&(_.preventDefault(),R(!0)),_.key==="Shift"&&(g.current=!0)},S=_=>{_.code==="Space"&&(_.preventDefault(),R(!1),C(!1),w(null)),_.key==="Shift"&&(g.current=!1,v.current=performance.now())},M=_=>{const h=r.current;if(!h)return;const m=_.target;m&&(m===h||h.contains(m))&&_.ctrlKey&&_.preventDefault()},I=_=>{const h=r.current;h&&h.contains(_.target)&&_.touches.length>1&&_.preventDefault()},z=_=>{const h=r.current;h&&h.contains(_.target)&&_.preventDefault()};return window.addEventListener("keydown",N),window.addEventListener("keyup",S),window.addEventListener("wheel",M,{passive:!1,capture:!0}),window.addEventListener("touchstart",I,{passive:!1}),window.addEventListener("gesturestart",z,{passive:!1}),()=>{window.removeEventListener("keydown",N),window.removeEventListener("keyup",S),window.removeEventListener("wheel",M,!0),window.removeEventListener("touchstart",I),window.removeEventListener("gesturestart",z)}},[]);const L=d.useCallback(N=>{N.preventDefault();const S=r.current;if(S){if(S.focus?.(),N.button===1||p&&N.button===0||!t){C(!0),w({x:N.clientX,y:N.clientY});return}if(t&&N.button===0){x(!0);const M=P(N.clientX,N.clientY);M.pressure=N.pressure||.5,j([M])}}},[P,t,p]),O=d.useCallback(N=>{if(A({x:N.clientX,y:N.clientY}),y&&f){const S=N.clientX-f.x,M=N.clientY-f.y;n.setPan(n.panX+S,n.panY+M),w({x:N.clientX,y:N.clientY})}else if(u&&t){const S=P(N.clientX,N.clientY);S.pressure=N.pressure||.5,n.currentBrushStyle;const M=.5;j(I=>{const z=I[I.length-1];if(!z)return[S];const _=S.x-z.x,h=S.y-z.y;return _*_+h*h<M*M?I:[...I,S]})}},[u,y,t,f,P,n]),G=d.useCallback(N=>{u&&t?(x(!1),B.current&&(cancelAnimationFrame(B.current),B.current=null),k.length>1&&n.addStroke({id:crypto.randomUUID(),points:k.map(S=>({...S})),color:n.currentColor,size:n.currentBrushStyle==="eraser"?n.eraserSize:n.currentSize,opacity:n.brushSettings.opacity??1,brushStyle:n.currentBrushStyle,timestamp:Date.now()}),j([])):y&&(C(!1),w(null))},[u,y,t,k,n]),V=d.useCallback(N=>{if(N.preventDefault(),N.stopPropagation(),N.ctrlKey||Math.abs(N.deltaY)>50){const S=N.deltaY>0?.9:1.1,M=Math.max(.1,Math.min(5,n.zoom*S)),I=r.current?.getBoundingClientRect();if(I){const z=N.clientX-I.left,_=N.clientY-I.top,h=(z-n.panX)/n.zoom,m=(_-n.panY)/n.zoom,b=z-h*M,D=_-m*M;n.setZoom(M),n.setPan(b,D)}}else{const S=performance.now()-v.current<600;(N.shiftKey||g.current||S?"horizontal":"none")==="horizontal"&&(l.current="horizontal"),c.current&&window.clearTimeout(c.current),c.current=window.setTimeout(()=>{l.current="none",c.current=null},600),l.current==="horizontal"?n.setPan(n.panX-N.deltaY*.5,n.panY):n.setPan(n.panX-N.deltaX*.5,n.panY-N.deltaY*.5)}},[n]);d.useEffect(()=>{te()},[te]);const Z=d.useCallback(()=>{if(A(null),i.current?.setCursor({visible:!1}),B.current&&(cancelAnimationFrame(B.current),B.current=null),i.current?.setPreviewStroke(null),r.current?.blur?.(),u&&t){if(x(!1),k.length>1){const S={id:Date.now().toString(),points:k,color:n.currentColor,size:n.currentBrushStyle==="eraser"?n.eraserSize:n.currentSize,opacity:n.brushSettings.opacity??1,brushStyle:n.currentBrushStyle,timestamp:Date.now()};n.addStroke(S)}j([])}y&&(C(!1),w(null))},[u,t,k,n,y]),q=()=>p||y?"cursor-grabbing":t?n.currentBrushStyle==="eraser"?"cursor-none":"cursor-crosshair":"cursor-grab";return d.useEffect(()=>{const N=i.current;if(!N)return;const S=r.current;if(S)if(E&&t&&n.currentBrushStyle==="eraser"&&!y&&!p){const M=S.getBoundingClientRect();N.setCursor({visible:!0,x:E.x-M.left,y:E.y-M.top,r:n.eraserSize*n.zoom/2})}else N.setCursor({visible:!1})},[E,t,n.currentBrushStyle,n.eraserSize,n.zoom,y,p]),o.jsx("div",{ref:r,className:`fixed inset-0 touch-none ${q()} ${e}`,tabIndex:0,onPointerDown:L,onPointerMove:O,onPointerUp:G,onPointerLeave:Z,onWheel:V,onContextMenu:N=>N.preventDefault(),style:{outline:"none",touchAction:"none",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",position:"fixed",inset:0,msContentZooming:"none",overscrollBehavior:"none",KhtmlUserSelect:"none",zIndex:0}})});var pr="Separator",bt="horizontal",mr=["horizontal","vertical"],Ht=d.forwardRef((t,e)=>{const{decorative:s,orientation:a=bt,...n}=t,r=gr(a)?a:bt,l=s?{role:"none"}:{"aria-orientation":r==="vertical"?r:void 0,role:"separator"};return o.jsx(ee.div,{"data-orientation":r,...l,...n,ref:e})});Ht.displayName=pr;function gr(t){return mr.includes(t)}var Yt=Ht;const et=d.forwardRef(({className:t,orientation:e="horizontal",decorative:s=!0,...a},n)=>o.jsx(Yt,{ref:n,decorative:s,orientation:e,className:ce("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));et.displayName=Yt.displayName;const xr=Re(({isDrawingMode:t,onToggleDrawingMode:e,className:s})=>{const a=Ee(),n=ze(),[r,i]=d.useState(!0),[l,c]=d.useState(!1),[g,v]=d.useState(!1),u=d.useRef(void 0),x=d.useRef(null);d.useEffect(()=>{const E=()=>v(window.innerWidth<768);return E(),window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]);const y={ink:o.jsx(Is,{className:"w-4 h-4"}),eraser:o.jsx(bs,{className:"w-4 h-4"}),spray:o.jsx(Os,{className:"w-4 h-4"}),texture:o.jsx(gs,{className:"w-4 h-4"})},C=["ink","eraser","spray","texture"];d.useEffect(()=>{if(!n.autoHideDock||g)return;const E=()=>{u.current&&clearTimeout(u.current),l||(u.current=setTimeout(()=>{i(!1)},n.dockHideDelay))},A=()=>{i(!0),E()},P=()=>A(),B=()=>A();return document.addEventListener("mousemove",P),document.addEventListener("pointermove",B),E(),()=>{document.removeEventListener("mousemove",P),document.removeEventListener("pointermove",B),u.current&&clearTimeout(u.current)}},[l,n.autoHideDock,n.dockHideDelay,g]);const k=()=>{c(!0),i(!0),u.current&&clearTimeout(u.current)},j=()=>{c(!1)},f=()=>{a.setZoom(Math.min(5,a.zoom*1.2))},w=()=>{a.setZoom(Math.max(.1,a.zoom/1.2))},p=()=>{a.setZoom(1),a.setPan(0,0)},R=E=>{a.setBrushStyle(E),t||e()};return!r&&n.autoHideDock&&!g?o.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 w-4 h-4 bg-gray-400 rounded-full opacity-30 hover:opacity-100 transition-opacity cursor-pointer z-50",onMouseEnter:k,title:"Show dock"}):o.jsx("div",{ref:x,className:`fixed bottom-4 sm:bottom-6 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 ${r?"opacity-100 translate-y-0":"opacity-0 translate-y-2"} ${s}`,onMouseEnter:k,onMouseLeave:j,children:o.jsx("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200 rounded-xl shadow-lg px-3 py-2",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(X,{variant:t?"default":"secondary",size:"sm",onClick:e,className:"h-9 w-9 p-0",title:t?"Switch to Pan Mode":"Switch to Draw Mode",children:t?o.jsx(Ps,{className:"w-4 h-4"}):o.jsx(Es,{className:"w-4 h-4"})}),o.jsx(et,{orientation:"vertical",className:"h-6 mx-1"}),o.jsx("div",{className:"flex items-center gap-1",children:C.map(E=>o.jsx(X,{variant:a.currentBrushStyle===E?"default":"ghost",size:"sm",onClick:()=>R(E),className:"h-9 w-9 p-0 transition-all hover:scale-105",title:`${E==="ink"?"Pen":E.charAt(0).toUpperCase()+E.slice(1)} brush`,children:y[E]},E))}),o.jsx(et,{orientation:"vertical",className:"h-6 mx-1"}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx(X,{variant:"ghost",size:"sm",onClick:w,className:"h-9 w-9 p-0",title:"Zoom Out",disabled:a.zoom<=.1,children:o.jsx(Ws,{className:"w-4 h-4"})}),o.jsxs("div",{className:"px-2 py-1 text-xs font-medium text-gray-600 min-w-[3rem] text-center bg-gray-100 rounded",children:[Math.round(a.zoom*100),"%"]}),o.jsx(X,{variant:"ghost",size:"sm",onClick:f,className:"h-9 w-9 p-0",title:"Zoom In",disabled:a.zoom>=5,children:o.jsx(Gs,{className:"w-4 h-4"})}),o.jsx(X,{variant:"ghost",size:"sm",onClick:p,className:"h-9 w-9 p-0",title:"Fit to Screen",children:o.jsx(Ns,{className:"w-4 h-4"})})]})]})})})});var Oe="Dialog",[Ut,Gr]=nt(Oe),[yr,ie]=Ut(Oe),Kt=t=>{const{__scopeDialog:e,children:s,open:a,defaultOpen:n,onOpenChange:r,modal:i=!0}=t,l=d.useRef(null),c=d.useRef(null),[g,v]=tt({prop:a,defaultProp:n??!1,onChange:r,caller:Oe});return o.jsx(yr,{scope:e,triggerRef:l,contentRef:c,contentId:Fe(),titleId:Fe(),descriptionId:Fe(),open:g,onOpenChange:v,onOpenToggle:d.useCallback(()=>v(u=>!u),[v]),modal:i,children:s})};Kt.displayName=Oe;var Vt="DialogTrigger",vr=d.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,n=ie(Vt,s),r=oe(e,n.triggerRef);return o.jsx(ee.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":ot(n.open),...a,ref:r,onClick:ne(t.onClick,n.onOpenToggle)})});vr.displayName=Vt;var rt="DialogPortal",[br,Gt]=Ut(rt,{forceMount:void 0}),Xt=t=>{const{__scopeDialog:e,forceMount:s,children:a,container:n}=t,r=ie(rt,e);return o.jsx(br,{scope:e,forceMount:s,children:d.Children.map(a,i=>o.jsx(Te,{present:s||r.open,children:o.jsx(Mn,{asChild:!0,container:n,children:i})}))})};Xt.displayName=rt;var _e="DialogOverlay",Wt=d.forwardRef((t,e)=>{const s=Gt(_e,t.__scopeDialog),{forceMount:a=s.forceMount,...n}=t,r=ie(_e,t.__scopeDialog);return r.modal?o.jsx(Te,{present:a||r.open,children:o.jsx(wr,{...n,ref:e})}):null});Wt.displayName=_e;var Sr=Fn("DialogOverlay.RemoveScroll"),wr=d.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,n=ie(_e,s);return o.jsx(In,{as:Sr,allowPinchZoom:!0,shards:[n.contentRef],children:o.jsx(ee.div,{"data-state":ot(n.open),...a,ref:e,style:{pointerEvents:"auto",...a.style}})})}),fe="DialogContent",Zt=d.forwardRef((t,e)=>{const s=Gt(fe,t.__scopeDialog),{forceMount:a=s.forceMount,...n}=t,r=ie(fe,t.__scopeDialog);return o.jsx(Te,{present:a||r.open,children:r.modal?o.jsx(Cr,{...n,ref:e}):o.jsx(kr,{...n,ref:e})})});Zt.displayName=fe;var Cr=d.forwardRef((t,e)=>{const s=ie(fe,t.__scopeDialog),a=d.useRef(null),n=oe(e,s.contentRef,a);return d.useEffect(()=>{const r=a.current;if(r)return Dn(r)},[]),o.jsx(qt,{...t,ref:n,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ne(t.onCloseAutoFocus,r=>{r.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:ne(t.onPointerDownOutside,r=>{const i=r.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&r.preventDefault()}),onFocusOutside:ne(t.onFocusOutside,r=>r.preventDefault())})}),kr=d.forwardRef((t,e)=>{const s=ie(fe,t.__scopeDialog),a=d.useRef(!1),n=d.useRef(!1);return o.jsx(qt,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{t.onCloseAutoFocus?.(r),r.defaultPrevented||(a.current||s.triggerRef.current?.focus(),r.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:r=>{t.onInteractOutside?.(r),r.defaultPrevented||(a.current=!0,r.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const i=r.target;s.triggerRef.current?.contains(i)&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&n.current&&r.preventDefault()}})}),qt=d.forwardRef((t,e)=>{const{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:r,...i}=t,l=ie(fe,s),c=d.useRef(null),g=oe(e,c);return _n(),o.jsxs(o.Fragment,{children:[o.jsx(zn,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:r,children:o.jsx(Tn,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":ot(l.open),...i,ref:g,onDismiss:()=>l.onOpenChange(!1)})}),o.jsxs(o.Fragment,{children:[o.jsx(Nr,{titleId:l.titleId}),o.jsx(Er,{contentRef:c,descriptionId:l.descriptionId})]})]})}),at="DialogTitle",Qt=d.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,n=ie(at,s);return o.jsx(ee.h2,{id:n.titleId,...a,ref:e})});Qt.displayName=at;var Jt="DialogDescription",en=d.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,n=ie(Jt,s);return o.jsx(ee.p,{id:n.descriptionId,...a,ref:e})});en.displayName=Jt;var tn="DialogClose",nn=d.forwardRef((t,e)=>{const{__scopeDialog:s,...a}=t,n=ie(tn,s);return o.jsx(ee.button,{type:"button",...a,ref:e,onClick:ne(t.onClick,()=>n.onOpenChange(!1))})});nn.displayName=tn;function ot(t){return t?"open":"closed"}var sn="DialogTitleWarning",[Xr,rn]=An(sn,{contentName:fe,titleName:at,docsSlug:"dialog"}),Nr=({titleId:t})=>{const e=rn(sn),s=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return d.useEffect(()=>{t&&(document.getElementById(t)||console.error(s))},[s,t]),null},jr="DialogDescriptionWarning",Er=({contentRef:t,descriptionId:e})=>{const a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${rn(jr).contentName}}.`;return d.useEffect(()=>{const n=t.current?.getAttribute("aria-describedby");e&&n&&(document.getElementById(e)||console.warn(a))},[a,t,e]),null},Rr=Kt,Pr=Xt,an=Wt,on=Zt,ln=Qt,cn=en,Mr=nn;const Ir=Rr,Dr=Pr,dn=d.forwardRef(({className:t,...e},s)=>o.jsx(an,{ref:s,className:ce("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...e}));dn.displayName=an.displayName;const un=d.forwardRef(({className:t,children:e,...s},a)=>o.jsxs(Dr,{children:[o.jsx(dn,{}),o.jsxs(on,{ref:a,className:ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[e,o.jsxs(Mr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[o.jsx(Ks,{className:"h-4 w-4"}),o.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));un.displayName=on.displayName;const hn=({className:t,...e})=>o.jsx("div",{className:ce("flex flex-col space-y-1.5 text-center sm:text-left",t),...e});hn.displayName="DialogHeader";const fn=d.forwardRef(({className:t,...e},s)=>o.jsx(ln,{ref:s,className:ce("text-lg font-semibold leading-none tracking-tight",t),...e}));fn.displayName=ln.displayName;const _r=d.forwardRef(({className:t,...e},s)=>o.jsx(cn,{ref:s,className:ce("text-sm text-muted-foreground",t),...e}));_r.displayName=cn.displayName;var Be="Checkbox",[zr,Wr]=nt(Be),[Tr,it]=zr(Be);function Ar(t){const{__scopeCheckbox:e,checked:s,children:a,defaultChecked:n,disabled:r,form:i,name:l,onCheckedChange:c,required:g,value:v="on",internal_do_not_use_render:u}=t,[x,y]=tt({prop:s,defaultProp:n??!1,onChange:c,caller:Be}),[C,k]=d.useState(null),[j,f]=d.useState(null),w=d.useRef(!1),p=C?!!i||!!C.closest("form"):!0,R={checked:x,disabled:r,setChecked:y,control:C,setControl:k,name:l,form:i,value:v,hasConsumerStoppedPropagationRef:w,required:g,defaultChecked:de(n)?!1:n,isFormControl:p,bubbleInput:j,setBubbleInput:f};return o.jsx(Tr,{scope:e,...R,children:Or(u)?u(R):a})}var pn="CheckboxTrigger",mn=d.forwardRef(({__scopeCheckbox:t,onKeyDown:e,onClick:s,...a},n)=>{const{control:r,value:i,disabled:l,checked:c,required:g,setControl:v,setChecked:u,hasConsumerStoppedPropagationRef:x,isFormControl:y,bubbleInput:C}=it(pn,t),k=oe(n,v),j=d.useRef(c);return d.useEffect(()=>{const f=r?.form;if(f){const w=()=>u(j.current);return f.addEventListener("reset",w),()=>f.removeEventListener("reset",w)}},[r,u]),o.jsx(ee.button,{type:"button",role:"checkbox","aria-checked":de(c)?"mixed":c,"aria-required":g,"data-state":bn(c),"data-disabled":l?"":void 0,disabled:l,value:i,...a,ref:k,onKeyDown:ne(e,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:ne(s,f=>{u(w=>de(w)?!0:!w),C&&y&&(x.current=f.isPropagationStopped(),x.current||f.stopPropagation())})})});mn.displayName=pn;var lt=d.forwardRef((t,e)=>{const{__scopeCheckbox:s,name:a,checked:n,defaultChecked:r,required:i,disabled:l,value:c,onCheckedChange:g,form:v,...u}=t;return o.jsx(Ar,{__scopeCheckbox:s,checked:n,defaultChecked:r,disabled:l,required:i,onCheckedChange:g,name:a,form:v,value:c,internal_do_not_use_render:({isFormControl:x})=>o.jsxs(o.Fragment,{children:[o.jsx(mn,{...u,ref:e,__scopeCheckbox:s}),x&&o.jsx(vn,{__scopeCheckbox:s})]})})});lt.displayName=Be;var gn="CheckboxIndicator",xn=d.forwardRef((t,e)=>{const{__scopeCheckbox:s,forceMount:a,...n}=t,r=it(gn,s);return o.jsx(Te,{present:a||de(r.checked)||r.checked===!0,children:o.jsx(ee.span,{"data-state":bn(r.checked),"data-disabled":r.disabled?"":void 0,...n,ref:e,style:{pointerEvents:"none",...t.style}})})});xn.displayName=gn;var yn="CheckboxBubbleInput",vn=d.forwardRef(({__scopeCheckbox:t,...e},s)=>{const{control:a,hasConsumerStoppedPropagationRef:n,checked:r,defaultChecked:i,required:l,disabled:c,name:g,value:v,form:u,bubbleInput:x,setBubbleInput:y}=it(yn,t),C=oe(s,y),k=Ct(r),j=St(a);d.useEffect(()=>{const w=x;if(!w)return;const p=window.HTMLInputElement.prototype,E=Object.getOwnPropertyDescriptor(p,"checked").set,A=!n.current;if(k!==r&&E){const P=new Event("click",{bubbles:A});w.indeterminate=de(r),E.call(w,de(r)?!1:r),w.dispatchEvent(P)}},[x,k,r,n]);const f=d.useRef(de(r)?!1:r);return o.jsx(ee.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??f.current,required:l,disabled:c,name:g,value:v,form:u,...e,tabIndex:-1,ref:C,style:{...e.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});vn.displayName=yn;function Or(t){return typeof t=="function"}function de(t){return t==="indeterminate"}function bn(t){return de(t)?"indeterminate":t?"checked":"unchecked"}const Sn=d.forwardRef(({className:t,...e},s)=>o.jsx(lt,{ref:s,className:ce("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...e,children:o.jsx(xn,{className:ce("flex items-center justify-center text-current"),children:o.jsx(On,{className:"h-4 w-4"})})}));Sn.displayName=lt.displayName;class Se{static async exportToPNG(e,s,a,n,r){const i=document.createElement("canvas");i.width=a*r.scale,i.height=n*r.scale;const l=i.getContext("2d");if(!l)throw new Error("Could not get canvas context");l.scale(r.scale,r.scale),r.transparentBackground||(s==="white"?(l.fillStyle="#ffffff",l.fillRect(0,0,a,n)):s==="grid"?(l.fillStyle="#ffffff",l.fillRect(0,0,a,n),this.drawGrid(l,a,n)):(l.fillStyle="#f8f9fa",l.fillRect(0,0,a,n)));const c=this.calculateStrokeBounds(e);if(c){const g=a/c.width,v=n/c.height,u=Math.min(g,v)*.9,x=(a-c.width*u)/2-c.minX*u,y=(n-c.height*u)/2-c.minY*u;l.save(),l.translate(x,y),l.scale(u,u)}return this.renderStrokesToCanvas(l,e,a,n),c&&l.restore(),i.toDataURL("image/png")}static async exportToJPG(e,s,a,n,r){const i=document.createElement("canvas");i.width=a*r.scale,i.height=n*r.scale;const l=i.getContext("2d");if(!l)throw new Error("Could not get canvas context");l.scale(r.scale,r.scale),s==="white"||r.transparentBackground?(l.fillStyle="#ffffff",l.fillRect(0,0,a,n)):s==="grid"?(l.fillStyle="#ffffff",l.fillRect(0,0,a,n),this.drawGrid(l,a,n)):(l.fillStyle="#f8f9fa",l.fillRect(0,0,a,n));const c=this.calculateStrokeBounds(e);if(c){const g=a/c.width,v=n/c.height,u=Math.min(g,v)*.9,x=(a-c.width*u)/2-c.minX*u,y=(n-c.height*u)/2-c.minY*u;l.save(),l.translate(x,y),l.scale(u,u)}return this.renderStrokesToCanvas(l,e,a,n),c&&l.restore(),i.toDataURL("image/jpeg",r.quality)}static async exportToSVG(e,s,a,n,r){const i=a*r.scale,l=n*r.scale;let c=`<svg width="${i}" height="${l}" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${i} ${l}">`;r.transparentBackground||(s==="white"?c+='<rect width="100%" height="100%" fill="#ffffff"/>':s==="grid"?(c+='<rect width="100%" height="100%" fill="#ffffff"/>',c+=this.generateGridSVG(i,l)):c+='<rect width="100%" height="100%" fill="#f8f9fa"/>');const g=this.calculateStrokeBounds(e);if(g){const v=i/g.width,u=l/g.height,x=Math.min(v,u)*.9,y=(i-g.width*x)/2-g.minX*x,C=(l-g.height*x)/2-g.minY*x;c+=`<g transform="translate(${y},${C}) scale(${x})">`}return e.forEach(v=>{if(v.points.length<2)return;const u=this.generateSVGPath(v,a,n,1);c+=`<path d="${u}" fill="${v.color}" stroke="none"/>`}),g&&(c+="</g>"),c+="</svg>",`data:image/svg+xml;charset=utf-8,${encodeURIComponent(c)}`}static renderStrokesToCanvas(e,s,a,n){s.forEach(r=>{if(r.points.length<2)return;const i=e.globalCompositeOperation;switch(e.globalCompositeOperation=r.brushStyle==="eraser"?"destination-out":"source-over",r.brushStyle){case"spray":this.renderSpray(e,r);break;case"texture":this.renderTexture(e,r);break;default:{const l=this.getStrokePath(r,a,n);if(!l)break;const c=e.globalAlpha;e.fillStyle=r.color,e.globalAlpha=(r.opacity??1)*c;const g=new Path2D(l);e.fill(g),e.globalAlpha=c;break}}e.globalCompositeOperation=i})}static getStrokePath(e,s,a){const n=e.points.map(l=>[l.x,l.y,l.pressure||.5]),r=je(n,{size:e.size,thinning:.5,smoothing:.5,streamline:.5,easing:l=>l,start:{taper:0,easing:l=>l},end:{taper:0,easing:l=>l}});if(!r.length)return"";const i=r.reduce((l,[c,g],v,u)=>{const[x,y]=u[(v+1)%u.length];return l.push(c,g,(c+x)/2,(g+y)/2),l},["M",...r[0],"Q"]);return i.push("Z"),i.join(" ")}static generateSVGPath(e,s,a,n){const r=e.points.map(c=>[c.x*n,c.y*n,c.pressure||.5]),i=je(r,{size:e.size*n,thinning:.5,smoothing:.5,streamline:.5,easing:c=>c,start:{taper:0,easing:c=>c},end:{taper:0,easing:c=>c}});if(!i.length)return"";const l=i.reduce((c,[g,v],u,x)=>{const[y,C]=x[(u+1)%x.length];return c.push(g,v,(g+y)/2,(v+C)/2),c},["M",...i[0],"Q"]);return l.push("Z"),l.join(" ")}static seededRandom(e){const s=Math.sin(e)*1e4;return s-Math.floor(s)}static renderSpray(e,s){const a=s.size,n=e.globalAlpha;e.fillStyle=s.color,e.globalAlpha=(s.opacity??1)*n;for(let r=0;r<s.points.length;r++){const{x:i,y:l,pressure:c=.5}=s.points[r],g=a*c,v=Math.max(3,g*.3);for(let u=0;u<v;u++){const x=i*1e3+l*100+u*10+r,y=i*100+l*1e3+u*5+r*2,C=i*10+l*10+u+r*3,k=this.seededRandom(x)*Math.PI*2,j=this.seededRandom(y)*g*.8,f=i+Math.cos(k)*j,w=l+Math.sin(k)*j,p=this.seededRandom(C)*2+.5;e.beginPath(),e.arc(f,w,p,0,Math.PI*2),e.fill()}}e.globalAlpha=n}static renderTexture(e,s){const a=e.globalAlpha,n=s.points.map(r=>[r.x,r.y,r.pressure??.5]);for(let r=0;r<3;r++){const i=.3-r*.1,l=r*2,c=n.map(([u,x,y],C)=>{const k=u*1e3+x*100+r*50+C,j=u*100+x*1e3+r*25+C*2;return[u+(this.seededRandom(k)-.5)*l,x+(this.seededRandom(j)-.5)*l,y]}),g=je(c,{size:s.size*(.8+r*.1),thinning:.7,smoothing:.5,streamline:.5,start:{cap:!1,taper:10},end:{cap:!1,taper:10},last:!0});if(g.length<3)continue;e.globalAlpha=(s.opacity??1)*i*a;const v=new Path2D(g.reduce((u,[x,y],C,k)=>{const[j,f]=k[(C+1)%k.length];return u.push(x,y,(x+j)/2,(y+f)/2),u},["M",...g[0],"Q"]).join(" ")+" Z");e.fillStyle=s.color,e.fill(v)}e.globalAlpha=a}static drawGrid(e,s,a){e.strokeStyle="#f0f0f0",e.lineWidth=1;for(let r=0;r<s;r+=20)e.beginPath(),e.moveTo(r,0),e.lineTo(r,a),e.stroke();for(let r=0;r<a;r+=20)e.beginPath(),e.moveTo(0,r),e.lineTo(s,r),e.stroke()}static generateGridSVG(e,s){let n='<g stroke="#f0f0f0" stroke-width="1" fill="none">';for(let r=0;r<e;r+=20)n+=`<line x1="${r}" y1="0" x2="${r}" y2="${s}"/>`;for(let r=0;r<s;r+=20)n+=`<line x1="0" y1="${r}" x2="${e}" y2="${r}"/>`;return n+="</g>",n}static downloadFile(e,s){const a=document.createElement("a");a.href=e,a.download=s,document.body.appendChild(a),a.click(),document.body.removeChild(a)}static calculateStrokeBounds(e){if(e.length===0)return null;let s=1/0,a=1/0,n=-1/0,r=-1/0;return e.forEach(i=>{i.points.forEach(l=>{s=Math.min(s,l.x),a=Math.min(a,l.y),n=Math.max(n,l.x),r=Math.max(r,l.y)})}),{minX:s,minY:a,maxX:n,maxY:r,width:n-s,height:r-a}}}const Br=Re(({isOpen:t,onClose:e,onExport:s,strokes:a,background:n,drawingName:r})=>{const i=ze(),[l,c]=d.useState(""),[g,v]=d.useState(!1),[u,x]=d.useState(!1);d.useEffect(()=>{t&&y()},[t,i.exportSettings,a,n]);const y=async()=>{if(a.length!==0){v(!0);try{const p=await Se.exportToPNG(a,n,400,300,{...i.exportSettings,scale:1});c(p)}catch(p){console.error("Failed to generate preview:",p)}finally{v(!1)}}},C=p=>{s(p),e()},k=async()=>{if(!u){x(!0);try{const p=await Se.exportToJPG(a,n,800,600,{...i.exportSettings,scale:1,quality:.8,transparentBackground:!1}),R=He.createShareData(r,p),E=He.checkSizeLimit(R);if(!E.valid){he.error(E.message||"Drawing is too large to share");return}const A=await He.storeSharedDrawing(R);if(!A.success)throw new Error(A.error||"Failed to create share link");const P=A.shareUrl;navigator.share?await navigator.share({title:`Check out my drawing: ${r}`,text:"I created this drawing with Wearlsketch!",url:P}):(await navigator.clipboard.writeText(P),he.success("Share link copied to clipboard! (expires in 30 days)"))}catch(p){console.error("Failed to share:",p),p instanceof Error?p.message.includes("too large")?he.error("Drawing is too large to share. Try reducing complexity or export as a file instead."):p.message.includes("not available")?he.error("Sharing service is temporarily unavailable. Please try again later."):he.error(p.message):he.error("Failed to create share link. Please try again.")}finally{x(!1)}}},j=p=>{i.setExportSettings({quality:p[0]/100})},f=p=>{i.setExportSettings({scale:p[0]})},w=p=>{i.setExportSettings({transparentBackground:p})};return o.jsx(Ir,{open:t,onOpenChange:e,children:o.jsxs(un,{className:"max-w-4xl w-full h-[85vh]",children:[o.jsx(hn,{children:o.jsxs(fn,{className:"flex items-center gap-2",children:[o.jsx(We,{className:"w-5 h-5"}),"Export Drawing: ",r]})}),o.jsxs("div",{className:"flex gap-6 h-full",children:[o.jsxs("div",{className:"flex-1 flex flex-col",children:[o.jsx(J,{className:"text-sm font-medium mb-3",children:"Preview"}),o.jsx("div",{className:"flex-1 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center min-h-[300px]",children:g?o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),o.jsx("span",{className:"text-gray-500",children:"Generating preview..."})]}):l?o.jsx("img",{src:l,alt:"Preview",className:"max-w-full max-h-full object-contain rounded"}):o.jsxs("div",{className:"text-center text-gray-500",children:[o.jsx(Ve,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),o.jsx("span",{children:"No preview available"})]})})]}),o.jsxs("div",{className:"w-80 flex flex-col",children:[o.jsxs("div",{className:"space-y-6 flex-1",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx(J,{className:"text-sm font-medium",children:"Export Format"}),o.jsxs(X,{onClick:()=>C("png"),className:"w-full h-16 bg-blue-600 hover:bg-blue-700 text-white flex flex-col items-center justify-center gap-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ve,{className:"w-5 h-5"}),o.jsx("span",{className:"font-semibold",children:"PNG"})]}),o.jsx("span",{className:"text-xs opacity-90",children:"Best quality  Supports transparency"})]}),o.jsxs(X,{onClick:()=>C("jpg"),className:"w-full h-16 bg-orange-600 hover:bg-orange-700 text-white flex flex-col items-center justify-center gap-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Ve,{className:"w-5 h-5"}),o.jsx("span",{className:"font-semibold",children:"JPG"})]}),o.jsx("span",{className:"text-xs opacity-90",children:"Smaller file size  No transparency"})]}),o.jsxs(X,{onClick:()=>C("svg"),className:"w-full h-16 bg-green-600 hover:bg-green-700 text-white flex flex-col items-center justify-center gap-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Cs,{className:"w-5 h-5"}),o.jsx("span",{className:"font-semibold",children:"SVG"})]}),o.jsx("span",{className:"text-xs opacity-90",children:"Vector format  Infinitely scalable"})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(J,{className:"text-sm font-medium",children:"Share"}),o.jsx(X,{onClick:k,variant:"outline",disabled:u,className:"w-full h-12 border-2 border-purple-200 hover:bg-purple-50 text-purple-700 hover:text-purple-800 flex items-center justify-center gap-2 disabled:opacity-50",children:u?o.jsxs(o.Fragment,{children:[o.jsx(Yn,{className:"w-4 h-4 animate-spin"}),o.jsx("span",{className:"font-medium",children:"Creating Link..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(Hn,{className:"w-4 h-4"}),o.jsx("span",{className:"font-medium",children:"Create Share Link"})]})}),o.jsx("p",{className:"text-xs text-gray-500",children:"Creates a secure shareable URL that expires in 30 days. Drawing data is stored safely in the cloud."})]}),o.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[o.jsx(J,{className:"text-sm font-medium",children:"Export Settings"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs text-gray-600",children:["Quality Scale: ",i.exportSettings.scale,"x"]}),o.jsx(le,{value:[i.exportSettings.scale],onValueChange:f,min:.5,max:4,step:.5,className:"w-full"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs(J,{className:"text-xs text-gray-600",children:["JPG Quality:"," ",Math.round(i.exportSettings.quality*100),"%"]}),o.jsx(le,{value:[i.exportSettings.quality*100],onValueChange:j,min:10,max:100,step:5,className:"w-full"})]}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(Sn,{id:"transparent",checked:i.exportSettings.transparentBackground,onCheckedChange:w}),o.jsx(J,{htmlFor:"transparent",className:"text-xs text-gray-600",children:"Transparent background (PNG/SVG only)"})]})]})]}),o.jsx("div",{className:"pt-4 border-t",children:o.jsx(X,{variant:"outline",onClick:e,className:"w-full",children:"Close"})})]})]})]})})});class Lr{static generateThumbnail(e,s,a=200,n=150){const r=document.createElement("canvas");r.width=a,r.height=n;const i=r.getContext("2d");if(!i)return"";if(s==="white"?(i.fillStyle="#ffffff",i.fillRect(0,0,a,n)):s==="grid"?(i.fillStyle="#ffffff",i.fillRect(0,0,a,n),this.drawGrid(i,a,n)):(i.strokeStyle="#e5e7eb",i.lineWidth=1,i.strokeRect(0,0,a,n)),e.length===0)return r.toDataURL();let l=Number.POSITIVE_INFINITY,c=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,v=Number.NEGATIVE_INFINITY;e.forEach(p=>{p.points.forEach(R=>{l=Math.min(l,R.x),c=Math.min(c,R.y),g=Math.max(g,R.x),v=Math.max(v,R.y)})});const u=.1,x=g-l,y=v-c;l-=x*u,c-=y*u,g+=x*u,v+=y*u;const C=a/(g-l),k=n/(v-c),j=Math.min(C,k,1),f=(a-(g-l)*j)/2,w=(n-(v-c)*j)/2;return e.forEach(p=>{if(p.points.length<2)return;const R=i.globalCompositeOperation;if(i.globalCompositeOperation=p.brushStyle==="eraser"?"destination-out":"source-over",p.brushStyle==="spray"){const E=i.globalAlpha;i.fillStyle=p.color,i.globalAlpha=p.opacity??1*E;const A=p.size*j;for(let P=0;P<p.points.length;P++){const{x:B,y:te,pressure:L=.5}=p.points[P],O=A*L,G=Math.max(2,O*.25);for(let V=0;V<G;V++){const Z=(B-l)*j+f+(Math.random()-.5)*O*.8,q=(te-c)*j+w+(Math.random()-.5)*O*.8,N=Math.random()*2+.5;i.beginPath(),i.arc(Z,q,N,0,Math.PI*2),i.fill()}}i.globalAlpha=E}else{i.beginPath(),i.strokeStyle=p.color,i.globalAlpha=p.opacity??1,i.lineWidth=Math.max(1,p.size*j),i.lineCap="round",i.lineJoin="round";const E=p.points[0];i.moveTo((E.x-l)*j+f,(E.y-c)*j+w);for(let A=1;A<p.points.length;A++){const P=p.points[A];i.lineTo((P.x-l)*j+f,(P.y-c)*j+w)}i.stroke()}i.globalCompositeOperation=R}),r.toDataURL()}static drawGrid(e,s,a){e.strokeStyle="#f0f0f0",e.lineWidth=.5;for(let r=0;r<s;r+=10)e.beginPath(),e.moveTo(r,0),e.lineTo(r,a),e.stroke();for(let r=0;r<a;r+=10)e.beginPath(),e.moveTo(0,r),e.lineTo(s,r),e.stroke()}}const Zr=Re(({editingDrawingId:t,onBackToVault:e})=>{const s=Ee(),a=Bn(),n=ze(),[r,i]=d.useState("Untitled Drawing"),[l,c]=d.useState(!0),[g,v]=d.useState(!1),[u,x]=d.useState(!1);d.useEffect(()=>{s.clearHistory()},[]),d.useEffect(()=>{if(t){const f=a.loadDrawing(t);f&&(s.replaceStrokes(f.strokes),i(f.name),s.setBackground(f.background))}else s.clear(),i("Untitled Drawing")},[t,s,a]);const y=async()=>{if(s.isEmpty)return;const f=Lr.generateThumbnail(s.strokes,s.background,200,150);t?await a.updateDrawing(t,s.strokes.map(w=>({id:w.id,points:w.points.map(p=>({x:p.x,y:p.y,pressure:p.pressure})),color:w.color,size:w.size,brushStyle:w.brushStyle,timestamp:w.timestamp})),f,s.background):await a.addDrawing(r,s.strokes.map(w=>({id:w.id,points:w.points.map(p=>({x:p.x,y:p.y,pressure:p.pressure})),color:w.color,size:w.size,brushStyle:w.brushStyle,timestamp:w.timestamp})),f,s.background),he.success("Drawing saved successfully!")},C=async f=>{if(!s.isEmpty)try{let w;const p={width:1920,height:1080};switch(f){case"png":w=await Se.exportToPNG(s.strokes,s.background,p.width,p.height,n.exportSettings);break;case"jpg":w=await Se.exportToJPG(s.strokes,s.background,p.width,p.height,n.exportSettings);break;case"svg":w=await Se.exportToSVG(s.strokes,s.background,p.width,p.height,n.exportSettings);break;default:throw new Error(`Unsupported format: ${f}`)}const R=`${r.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.${f}`;Se.downloadFile(w,R)}catch(w){console.error("Export failed:",w),alert("Export failed. Please try again.")}},k=()=>{c(!l)},j=()=>{v(!0)};return Un(y,j),o.jsxs("div",{className:"fixed inset-0 bg-gray-100",children:[o.jsx("div",{className:`fixed top-0 left-0 h-full transition-all duration-300 z-10 ${u?"w-12":"w-80"}`,children:u?o.jsx("div",{className:"w-12 bg-white/90 backdrop-blur-sm border-r border-gray-200 flex flex-col items-center py-4 h-full",children:o.jsx(X,{variant:"ghost",size:"sm",onClick:()=>x(!1),className:"p-2",children:o.jsx(Ln,{className:"w-4 h-4"})})}):o.jsx("div",{className:"bg-white/90 backdrop-blur-sm border-r border-gray-200 h-full",children:o.jsx(Zs,{onSave:y,onExport:j,onCollapse:()=>x(!0),isDrawingMode:l,onForceDrawingMode:()=>c(!0)})})}),o.jsxs("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-sm border border-gray-200 rounded-lg px-4 py-2 flex items-center gap-4 z-10",children:[o.jsxs(X,{variant:"ghost",onClick:e,className:"flex items-center gap-2",children:[o.jsx(ps,{className:"w-4 h-4"}),"Back to Vault"]}),o.jsx("input",{type:"text",value:r,onChange:f=>i(f.target.value),className:"text-lg font-semibold bg-transparent border-none outline-none focus:bg-gray-50 px-2 py-1 rounded"})]}),o.jsx(fr,{isDrawingMode:l}),o.jsx(xr,{isDrawingMode:l,onToggleDrawingMode:k}),o.jsx(Br,{isOpen:g,onClose:()=>v(!1),onExport:C,strokes:s.strokes,background:s.background,drawingName:r})]})});export{Zr as C};
